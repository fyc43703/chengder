<!DOCTYPE html><html lang="zh-Hant"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Podcast 搜尋與播放器</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/stackoverflow-light.min.css">
<style>
      /* General Styles */
      html, body {
        margin: 0;
        padding: 24px;
        background: #FFFFFF;
        color: #1d1d1f;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        font-size: 15px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      h1, h2, h3, h4, h5, h6, b, strong {
        font-weight: 600; /* Semibold for macOS look */
      }
      h1 { font-weight: 700; } /* Bold for main title */
      
      /* Explicit list styles for consistent rendering in html2canvas */
      ul, ol { padding-left: 2em; margin-top: 1em; margin-bottom: 1em; }
      ul { list-style-type: disc; }
      ol { list-style-type: decimal; }
      li { display: list-item; }

      .hljs-container {
        padding: 1.5rem;
        border-radius: .75rem;
        overflow-x: auto;
        background: #fcfcfd;
        border: 1px solid #d2d2d7;
      }
      .text-highlight{background:linear-gradient(180deg,transparent 25%,#B3D7FF 25%,#B3D7FF 75%,transparent 75%);padding:0 2px;margin:0;display:inline;line-height:inherit;box-decoration-break:clone;-webkit-box-decoration-break:clone;border-radius:2px;font-weight:500}
      .text-highlight-multiline{background:linear-gradient(180deg,transparent 25%,#B3D7FF 25%,#B3D7FF 75%,transparent 75%);background-size:100% 1.5em;background-repeat:repeat;padding:0 2px;margin:0;display:inline;line-height:inherit;box-decoration-break:clone;-webkit-box-decoration-break:clone;border-radius:2px;font-weight:500}
      .text-highlight-error{background:linear-gradient(180deg,transparent 25%,#FFD7D8 25%,#FFD7D8 75%,transparent 75%);padding:0 2px;border-radius:2px;color:#D92525}
      .text-highlight-success{background:linear-gradient(180deg,transparent 25%,#D4EDDA 25%,#D4EDDA 75%,transparent 75%);padding:0 2px;border-radius:2px;color:#155724}
    </style></head><body><div style="max-width:1200px;margin:0 auto"><!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast 搜尋與播放器</title>
    <!-- 引入 Tailwind CSS 以進行快速的 UI 開發 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons 以美化圖示 -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        /* 自訂美化滾動條樣式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* 讓佈局在小螢幕上更友善 */
        .main-container {
            grid-template-columns: 1fr;
        }
        @media (min-width: 1024px) {
            .main-container {
                grid-template-columns: 400px 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div class="container mx-auto p-4 max-w-7xl">

        <!-- 頁首和搜尋欄 -->
        <header class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-center text-indigo-600 mb-4">Podcast 探索家</h1>
            <form id="search-form" class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="search-input" placeholder="例如：百靈果、科技島讀..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300" required>
                <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300 flex items-center justify-center gap-2">
                    <i data-lucide="search" class="w-5 h-5"></i>
                    <span>搜尋</span>
                </button>
            </form>
        </header>
        
        <!-- 載入狀態提示 -->
        <div id="loader" class="text-center p-10 hidden">
            <div role="status" class="flex justify-center items-center">
                <svg aria-hidden="true" class="w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-indigo-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
                    <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0492C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
                </svg>
                <span class="sr-only">載入中...</span>
            </div>
            <p class="mt-2 text-gray-600">正在努力搜尋中...</p>
        </div>

        <!-- 主要內容區：左側為搜尋結果，右側為單集列表 -->
        <main id="main-content" class="main-container grid gap-6">
            <!-- Podcast 搜尋結果 -->
            <div id="podcast-results" class="bg-white rounded-xl shadow-md p-4 overflow-y-auto" style="max-height: 70vh;">
                <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">搜尋結果</h2>
                <div id="podcast-list" class="space-y-3">
                    <p class="text-gray-500 text-center pt-8">請先搜尋您感興趣的 Podcast。</p>
                </div>
            </div>

            <!-- 單集列表 -->
            <div id="episodes-container" class="bg-white rounded-xl shadow-md p-4 overflow-y-auto" style="max-height: 70vh;">
                <div id="podcast-detail-header" class="text-center mb-4 hidden">
                    <img id="detail-artwork" src="" alt="Podcast Artwork" class="w-32 h-32 mx-auto rounded-lg shadow-lg mb-3">
                    <h2 id="detail-title" class="text-2xl font-bold text-gray-800"></h2>
                    <p id="detail-artist" class="text-md text-gray-500"></p>
                </div>
                <h3 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">單集列表</h3>
                <div id="episode-list" class="space-y-2">
                    <p class="text-gray-500 text-center pt-8">請先從左側選擇一個 Podcast 以顯示單集列表。</p>
                </div>
            </div>
        </main>
        
        <!-- 底部固定音訊播放器 -->
        <footer id="audio-player-container" class="sticky bottom-0 left-0 right-0 mt-6 bg-white/80 backdrop-blur-sm rounded-t-xl shadow-2xl p-4 transition-transform translate-y-full duration-500">
            <div class="flex items-center gap-4">
                <div class="flex-grow">
                    <p class="font-semibold text-gray-800 truncate" id="now-playing-title">未選擇音訊</p>
                    <audio id="audio-player" controls class="w-full mt-2"></audio>
                </div>
            </div>
        </footer>

    </div>

    <script>
        // DOM 元素選擇
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const loader = document.getElementById('loader');
        const mainContent = document.getElementById('main-content');
        const podcastList = document.getElementById('podcast-list');
        const episodeList = document.getElementById('episode-list');
        const audioPlayerContainer = document.getElementById('audio-player-container');
        const audioPlayer = document.getElementById('audio-player');
        const nowPlayingTitle = document.getElementById('now-playing-title');
        
        // Podcast 詳情 header
        const podcastDetailHeader = document.getElementById('podcast-detail-header');
        const detailArtwork = document.getElementById('detail-artwork');
        const detailTitle = document.getElementById('detail-title');
        const detailArtist = document.getElementById('detail-artist');

        // CORS 代理，用來解決跨域請求 RSS feed 的問題
        const CORS_PROXY = 'https://corsproxy.io/?';
        
        // 初始化 Lucide Icons
        lucide.createIcons();

        // 搜尋表單提交事件監聽
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                await searchPodcasts(searchTerm);
            }
        });

        // 函式：搜尋 Podcast
        async function searchPodcasts(term) {
            // 清空舊內容並顯示載入提示
            podcastList.innerHTML = '';
            episodeList.innerHTML = '<p class="text-gray-500 text-center pt-8">請先從左側選擇一個 Podcast 以顯示單集列表。</p>';
            podcastDetailHeader.classList.add('hidden');
            mainContent.classList.add('hidden');
            loader.classList.remove('hidden');

            const originalSearchUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(term)}&media=podcast&entity=podcast&country=TW&limit=50`;
            const searchUrl = `${CORS_PROXY}${encodeURIComponent(originalSearchUrl)}`;
            
            try {
                const response = await fetch(searchUrl);
                if (!response.ok) {
                    throw new Error(`HTTP 錯誤! 狀態: ${response.status}`);
                }
                const data = await response.json();
                displayPodcasts(data.results);
            } catch (error) {
                console.error('搜尋 Podcast 時發生錯誤:', error);
                podcastList.innerHTML = `<p class="text-red-500 text-center">搜尋失敗，請稍後再試。</p>`;
            } finally {
                // 隱藏載入提示並顯示內容
                loader.classList.add('hidden');
                mainContent.classList.remove('hidden');
            }
        }

        // 函式：顯示 Podcast 搜尋結果
        function displayPodcasts(podcasts) {
            podcastList.innerHTML = '';
            if (podcasts.length === 0) {
                podcastList.innerHTML = `<p class="text-gray-500 text-center">找不到相關的 Podcast。</p>`;
                return;
            }

            podcasts.forEach(podcast => {
                const podcastItem = document.createElement('div');
                podcastItem.className = 'flex items-center gap-4 p-3 rounded-lg hover:bg-gray-200 cursor-pointer transition duration-300';
                podcastItem.innerHTML = `
                    <img src="${podcast.artworkUrl100}" alt="${podcast.collectionName}" class="w-16 h-16 rounded-md object-cover shadow-sm">
                    <div class="flex-grow overflow-hidden">
                        <h4 class="font-semibold text-gray-900 truncate">${podcast.collectionName}</h4>
                        <p class="text-sm text-gray-500 truncate">${podcast.artistName}</p>
                    </div>
                `;
                // 點擊 podcast 項目時，獲取其單集列表
                podcastItem.addEventListener('click', () => {
                    // 標記選中的項目
                    document.querySelectorAll('#podcast-list .bg-indigo-100').forEach(el => el.classList.remove('bg-indigo-100', 'text-indigo-800'));
                    podcastItem.classList.add('bg-indigo-100', 'text-indigo-800');
                    
                    // 更新右側的 Podcast 詳情
                    detailArtwork.src = podcast.artworkUrl100;
                    detailTitle.textContent = podcast.collectionName;
                    detailArtist.textContent = podcast.artistName;
                    podcastDetailHeader.classList.remove('hidden');

                    fetchEpisodes(podcast.feedUrl);
                });
                podcastList.appendChild(podcastItem);
            });
        }

        // 函式：獲取單集列表 (透過 RSS Feed)
        async function fetchEpisodes(feedUrl) {
            episodeList.innerHTML = `
                <div class="flex justify-center items-center h-full pt-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div>
                    <p class="ml-3 text-gray-600">正在載入單集...</p>
                </div>
            `;
            const proxyUrl = `${CORS_PROXY}${encodeURIComponent(feedUrl)}`;
            
            try {
                const response = await fetch(proxyUrl);
                 if (!response.ok) {
                    throw new Error(`HTTP 錯誤! 狀態: ${response.status}`);
                }
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "application/xml");
                
                // 檢查是否有解析錯誤
                const parseError = xmlDoc.querySelector("parsererror");
                if (parseError) {
                    console.error("XML 解析錯誤:", parseError);
                    throw new Error("無法解析 RSS feed。");
                }

                const items = xmlDoc.querySelectorAll("item");
                displayEpisodes(items);
            } catch (error) {
                console.error('獲取單集列表時發生錯誤:', error);
                episodeList.innerHTML = `<p class="text-red-500 text-center">無法載入單集列表。可能是來源的 RSS Feed 有問題或網路不穩定。</p>`;
            }
        }
        
        // 函式：顯示單集列表
        function displayEpisodes(items) {
            episodeList.innerHTML = '';
            if (items.length === 0) {
                episodeList.innerHTML = `<p class="text-gray-500 text-center">這個 Podcast 沒有可用的單集。</p>`;
                return;
            }

            items.forEach(item => {
                const title = item.querySelector("title")?.textContent || '無標題';
                const enclosure = item.querySelector("enclosure");
                const audioUrl = enclosure ? enclosure.getAttribute("url") : null;

                if (audioUrl) {
                    const episodeItem = document.createElement('div');
                    episodeItem.className = 'p-3 border-b border-gray-200 last:border-b-0 flex justify-between items-center gap-3';
                    episodeItem.innerHTML = `
                        <p class="flex-grow text-sm text-gray-700">${title}</p>
                        <div class="flex-shrink-0 flex gap-2">
                             <button class="play-btn p-2 text-indigo-600 hover:bg-indigo-100 rounded-full transition duration-300" title="播放">
                                <i data-lucide="play-circle" class="w-6 h-6"></i>
                            </button>
                            <a href="${audioUrl}" download="${title.replace(/[^a-zA-Z0-9\s]/g, '')}.mp3" class="download-btn p-2 text-green-600 hover:bg-green-100 rounded-full transition duration-300" title="下載">
                                <i data-lucide="download" class="w-6 h-6"></i>
                            </a>
                        </div>
                    `;
                    // 播放按鈕事件
                    episodeItem.querySelector('.play-btn').addEventListener('click', () => {
                        playEpisode(audioUrl, title);
                    });
                    episodeList.appendChild(episodeItem);
                }
            });
            // 重新渲染圖示
            lucide.createIcons();
        }

        // 函式：播放指定的單集
        function playEpisode(url, title) {
            audioPlayer.src = url;
            nowPlayingTitle.textContent = title;
            audioPlayer.play();
            // 顯示播放器
            audioPlayerContainer.classList.remove('translate-y-full');
        }

    </script>
</body>
</html>


</div></body></html>
