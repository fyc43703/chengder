<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 語句潤飾工具 (日系風格版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Yuji+Syuku&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f4f1ea; /* 柔和的米色背景 */
        }
        .font-jp-title {
            font-family: 'Yuji Syuku', serif;
        }
        .custom-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }
        .lds-dual-ring {
            display: inline-block;
            width: 80px;
            height: 80px;
        }
        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 64px;
            height: 64px;
            margin: 8px;
            border-radius: 50%;
            border: 6px solid #86a3a3; /* muted teal */
            border-color: #86a3a3 transparent #86a3a3 transparent;
            animation: lds-dual-ring 1.2s linear infinite;
        }
        @keyframes lds-dual-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* 更新差異顯示樣式以匹配新色調 */
        .diff-added {
            background-color: #e0f2f1;
            color: #004d40;
            text-decoration: none;
        }
        .diff-removed {
            background-color: #ffcdd2;
            color: #b71c1c;
            text-decoration: line-through;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-5xl mx-auto bg-white/80 backdrop-blur-sm rounded-lg custom-shadow p-6 md:p-8 space-y-6 border border-gray-200/80">
        <div class="text-center">
            <h1 class="font-jp-title text-4xl md:text-5xl font-normal tracking-wider text-gray-700">
                AI 語句潤飾工具
            </h1>
            <p class="mt-4 text-gray-600">輸入您想優化的文字，選擇風格，AI 將幫助您寫得更精準、更流暢。</p>
            <p class="mt-2 text-sm text-gray-500">製作者：陳政德</p>
        </div>

        <!-- 功能選項 -->
        <div class="flex flex-col md:flex-row items-center justify-center gap-4">
             <div class="w-full md:w-1/2">
                <label for="polishStyle" class="block text-sm font-medium text-gray-700 mb-1">選擇潤飾風格：</label>
                <select id="polishStyle" class="w-full p-2 border border-gray-300 rounded-lg bg-white/50 focus:ring-2 focus:ring-[#86a3a3] focus:border-[#86a3a3] transition duration-200">
                    <option value="general">通用潤飾 (更通順)</option>
                    <option value="professional">專業正式 (商業、學術)</option>
                    <option value="casual">口語活潑 (社群、部落格)</option>
                    <option value="concise">精簡扼要 (縮短句子)</option>
                    <option value="grammar">修正文法與錯字</option>
                    <option value="official_document">符合公文用語規範</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
                <label for="inputText" class="text-sm font-medium text-gray-700">原文：</label>
                <textarea id="inputText" rows="12" class="w-full p-4 border border-gray-200 bg-white/50 rounded-lg focus:ring-2 focus:ring-[#86a3a3] focus:border-[#86a3a3] transition duration-200" placeholder="在這裡輸入您的句子..."></textarea>
                <div id="inputCharCount" class="text-right text-sm text-gray-500">字數：0</div>
            </div>
            
            <div class="space-y-2">
                <div class="flex justify-between items-center">
                    <h2 class="text-sm font-medium text-gray-700">優化結果：</h2>
                    <button id="copyButton" class="flex items-center gap-1 text-sm bg-gray-200/80 hover:bg-gray-300/80 text-gray-700 font-medium py-1 px-3 rounded-lg transition duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        <span>複製</span>
                    </button>
                </div>
                <div id="outputText" class="w-full p-4 h-full min-h-[200px] md:min-h-0 bg-gray-50/80 border border-gray-200/80 rounded-lg text-gray-800 whitespace-pre-wrap overflow-y-auto"></div>
                <div id="outputCharCount" class="text-right text-sm text-gray-500">字數：0</div>
            </div>
        </div>
        
        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 pt-4">
            <button id="polishButton" class="w-full sm:w-auto flex justify-center items-center gap-2 bg-[#86a3a3] text-white font-medium py-3 px-6 rounded-lg hover:bg-[#708d8d] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#86a3a3] transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sparkles"><path d="M12 2L14.39 8.36L21 9.61L16.42 14.84L18.18 21.5L12 17.77L5.82 21.5L7.58 14.84L3 9.61L9.61 8.36L12 2z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>
                <span>開始潤飾</span>
            </button>
            <button id="clearButton" class="w-full sm:w-auto flex justify-center items-center gap-2 bg-transparent text-gray-600 border border-gray-300 font-medium py-3 px-6 rounded-lg hover:bg-gray-100/80 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                <span>清除內容</span>
            </button>
        </div>
    </div>

    <script>
        const polishButton = document.getElementById('polishButton');
        const clearButton = document.getElementById('clearButton');
        const copyButton = document.getElementById('copyButton');
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const polishStyleSelect = document.getElementById('polishStyle');
        const inputCharCount = document.getElementById('inputCharCount');
        const outputCharCount = document.getElementById('outputCharCount');

        // --- Event Listeners ---
        polishButton.addEventListener('click', polishSentence);
        clearButton.addEventListener('click', clearContent);
        copyButton.addEventListener('click', copyToClipboard);
        inputText.addEventListener('input', () => updateCharCount(inputText, inputCharCount));

        function updateCharCount(inputElement, countElement) {
            const count = inputElement.value.length;
            countElement.textContent = `字數：${count}`;
        }

        function clearContent() {
            inputText.value = '';
            outputText.innerHTML = '';
            updateCharCount(inputText, inputCharCount);
            updateCharCount({value: ''}, outputCharCount); // Reset output count
        }

        function copyToClipboard() {
            // 從 diff HTML 中提取純文字
            const plainText = outputText.textContent;
            if (plainText) {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = plainText;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    const originalButtonHTML = copyButton.innerHTML;
                    copyButton.innerHTML = `<span>已複製！</span>`;
                    setTimeout(() => {
                        copyButton.innerHTML = originalButtonHTML;
                    }, 2000);
                } catch (err) {
                    console.error('無法複製文字: ', err);
                }
                document.body.removeChild(tempTextArea);
            }
        }
        
        // 只顯示新文的函數
        function generateDiffHTML(original, polished) {
            // 直接回傳用 .diff-added 包裹的潤飾後文字
            return `<span class="diff-added">${polished}</span>`;
        }


        async function polishSentence() {
            const originalText = inputText.value.trim();
            if (!originalText) {
                outputText.textContent = '請先輸入您想要潤飾的句子。';
                return;
            }

            // --- Show loading indicator ---
            outputText.innerHTML = '<div class="flex justify-center items-center h-full"><div class="lds-dual-ring"></div></div>';
            polishButton.disabled = true;
            clearButton.disabled = true;
            copyButton.disabled = true;
            polishButton.classList.add('opacity-50', 'cursor-not-allowed');
            clearButton.classList.add('opacity-50', 'cursor-not-allowed');

            const stylePrompts = {
                general: "你是一位專業的中文寫作專家，請將以下句子潤飾得更通順、精煉，同時完整保留原始語意。",
                professional: "你是一位資深的商業與學術編輯，請將以下文字改寫得非常專業、正式、客觀，適用於報告或論文，同時完整保留原始語意。",
                casual: "你是一位社群文案高手，請將以下句子改寫得更口語化、活潑、有吸引力，適合用在部落格或社群媒體，同時完整保留原始語意。",
                concise: "你是一位精煉的文字編輯，請將以下句子縮短，用最少的字表達核心意思，移除贅字，同時完整保留原始語意。",
                grammar: "你是一位嚴謹的校稿員，請只修正以下句子中的錯別字、標點符號和語法錯誤，不要改變句意或風格。",
                official_document: "你是一位精通政府公文寫作的專家，請將以下文字改寫成符合公文用語規範的正式書面語，確保用詞精確、語氣莊重，同時完整保留原始語意。"
            };

            const selectedStyle = polishStyleSelect.value;
            const systemPrompt = stylePrompts[selectedStyle] + " 請直接提供優化後的版本，不需要任何額外解釋。請使用繁體中文回答。";
            const userQuery = originalText;
            
            // --- API 金鑰和端點 ---
            // !!! 安全警告 !!!
            // 將 API 金鑰直接寫在前端是非常不安全的，任何人都可以看到並盜用。
            // 在正式環境中，您應該透過後端伺服器來呼叫 API。
            const apiKey = "AIzaSyD1eAmZ-gOlU9VG-06ClJVXg21e4OE17Nc"; // <-- 在此處貼上您的 API 金鑰 (僅供測試)
            const modelName = "gemini-1.5-flash-latest";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

            if (!apiKey) {
                outputText.textContent = "錯誤：尚未設定 API 金鑰。請在程式碼中填入您的 Google AI API 金鑰。";
                 // --- Hide loading indicator ---
                polishButton.disabled = false;
                clearButton.disabled = false;
                copyButton.disabled = false;
                polishButton.classList.remove('opacity-50', 'cursor-not-allowed');
                clearButton.classList.remove('opacity-50', 'cursor-not-allowed');
                return;
            }


            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                safetySettings: [
                    { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                ]
            };

            try {
                let response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`請求失敗，狀態碼：${response.status}. 詳情: ${errorText}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    if (candidate.finishReason === 'SAFETY') {
                        outputText.textContent = '抱歉，您的輸入內容可能違反了使用政策，無法處理。請修改後再試。';
                    } else {
                        const polishedText = candidate.content.parts[0].text;
                        outputText.innerHTML = generateDiffHTML(originalText, polishedText);
                        updateCharCount({value: polishedText}, outputCharCount);
                    }
                } else {
                    outputText.textContent = '抱歉，無法生成結果。請檢查您的輸入或稍後再試。';
                    console.error('Unexpected API response structure:', result);
                }

            } catch (error) {
                console.error('Error:', error);
                outputText.textContent = '發生錯誤，請稍後再試。\n' + error.message;
            } finally {
                // --- Hide loading indicator ---
                polishButton.disabled = false;
                clearButton.disabled = false;
                copyButton.disabled = false;
                polishButton.classList.remove('opacity-50', 'cursor-not-allowed');
                clearButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Initialize char count
        updateCharCount(inputText, inputCharCount);
    </script>
</body>
</html>

