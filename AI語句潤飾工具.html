<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 語句潤飾工具 (京都禪風)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Yuji+Syuku&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #3e2723; /* 深棕色基底 */
            background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png'); /* 木質紋理 */
        }
        .font-jp-title {
            font-family: 'Yuji Syuku', serif;
        }
        .custom-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15), 0 8px 10px -6px rgba(0, 0, 0, 0.15);
        }
        .lds-dual-ring {
            display: inline-block;
            width: 80px;
            height: 80px;
        }
        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 64px;
            height: 64px;
            margin: 8px;
            border-radius: 50%;
            border: 6px solid #a72626; /* 朱紅色 */
            border-color: #a72626 transparent #a72626 transparent;
            animation: lds-dual-ring 1.2s linear infinite;
        }
        @keyframes lds-dual-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* 更新差異顯示樣式 */
        .diff-added {
            background-color: transparent;
            color: #2e7d32; /* 沉穩的綠色 */
            font-weight: 500;
            text-decoration: none;
        }
        .diff-removed {
            background-color: #ffcdd2; /* 淡紅色背景 */
            color: #c62828;
            text-decoration: line-through;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-7xl mx-auto bg-[#f4f1ea]/95 backdrop-blur-sm rounded-lg custom-shadow p-6 md:p-8 space-y-6 border border-[#795548]/70 transform scale-85">
        <div class="text-center">
            <h1 class="font-jp-title text-4xl md:text-5xl font-normal tracking-wider text-[#4e342e]">
                AI 語句潤飾工具
            </h1>
            <p class="mt-4 text-[#5d4037]">輸入您想優化的文字，選擇風格，AI 將幫助您寫得更精準、更流暢。</p>
            <p class="mt-2 text-sm text-[#6d4c41]">製作者：陳政德</p>
        </div>

        <!-- 功能選項 -->
        <div class="flex flex-col md:flex-row items-center justify-center gap-4">
             <div class="w-full md:w-1/2">
                <label for="polishStyle" class="block text-sm font-medium text-[#6d4c41] mb-1">選擇潤飾風格：</label>
                <select id="polishStyle" class="w-full p-2 border border-[#a1887f] rounded-lg bg-white/50 focus:ring-2 focus:ring-[#a72626] focus:border-[#a72626] transition duration-200 text-[#6d4c41]">
                    <option value="general">通用潤飾 (更通順)</option>
                    <option value="professional">專業正式 (商業、學術)</option>
                    <option value="casual">口語活潑 (社群、部落格)</option>
                    <option value="concise">精簡扼要 (縮短句子)</option>
                    <option value="grammar">修正文法與錯字</option>
                    <option value="official_document">符合公文用語規範</option>
                    <option value="humorous">幽默輕鬆風格</option>
                    <option value="poetic">詩意優雅風格</option>
                    <option value="news">新聞報導風格</option>
                    <option value="classical">古典文言風格</option>
                </select>
            </div>
        </div>
        
        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 pt-6">
            <button id="polishButton" class="w-full sm:w-auto flex justify-center items-center gap-2 bg-[#a72626] text-white font-medium py-3 px-6 rounded-lg hover:bg-[#8e2424] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#a72626] transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sparkles"><path d="M12 2L14.39 8.36L21 9.61L16.42 14.84L18.18 21.5L12 17.77L5.82 21.5L7.58 14.84L3 9.61L9.61 8.36L12 2z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>
                <span>開始潤飾</span>
            </button>
            <button id="clearButton" class="w-full sm:w-auto flex justify-center items-center gap-2 bg-transparent text-[#6d4c41] border border-[#a1887f] font-medium py-3 px-6 rounded-lg hover:bg-[#efebe9]/60 hover:border-[#8d6e63] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#a1887f] transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                <span>清除內容</span>
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
                <label for="inputText" class="text-sm font-medium text-[#6d4c41]">原文：</label>
                <div class="relative w-full">
                    <textarea id="inputText" class="w-full h-96 p-4 pr-10 border border-[#a1887f] bg-white/50 rounded-lg focus:ring-2 focus:ring-[#a72626] focus:border-[#a72626] transition duration-200 text-[#4e342e] resize-none" placeholder="在這裡輸入您的句子..."></textarea>
                    <button id="clearInputButton" title="清除原文" class="absolute top-3 right-3 text-[#8d6e63] hover:text-[#a72626] transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                    </button>
                </div>
                <div id="inputCharCount" class="text-right text-sm text-[#6d4c41]">字數：0</div>
            </div>
            
            <div class="space-y-2">
                <div class="flex justify-between items-center">
                    <h2 class="text-sm font-medium text-[#6d4c41]">優化結果：</h2>
                    <button id="copyButton" class="flex items-center gap-1 text-sm bg-[#d7ccc8]/70 hover:bg-[#bcaaa4]/70 text-[#6d4c41] font-medium py-1 px-3 rounded-lg transition duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        <span>複製優化後文字</span>
                    </button>
                </div>
                <div id="outputText" class="w-full h-96 p-4 bg-[#f1f8f7]/90 border border-[#a1887f]/80 rounded-lg text-[#4e342e] whitespace-pre-wrap overflow-y-auto"></div>
                <div id="outputCharCount" class="text-right text-sm text-[#6d4c41]">字數：0</div>
            </div>
        </div>
        
    </div>

    <script>
        const polishButton = document.getElementById('polishButton');
        const clearButton = document.getElementById('clearButton');
        const copyButton = document.getElementById('copyButton');
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const polishStyleSelect = document.getElementById('polishStyle');
        const inputCharCount = document.getElementById('inputCharCount');
        const outputCharCount = document.getElementById('outputCharCount');
        const clearInputButton = document.getElementById('clearInputButton');

        // --- Event Listeners ---
        polishButton.addEventListener('click', polishSentence);
        clearButton.addEventListener('click', clearContent);
        copyButton.addEventListener('click', copyToClipboard);
        inputText.addEventListener('input', () => updateCharCount(inputText, inputCharCount));
        clearInputButton.addEventListener('click', () => {
            inputText.value = '';
            updateCharCount(inputText, inputCharCount);
            inputText.focus();
        });


        function updateCharCount(inputElement, countElement) {
            const count = inputElement.value.length;
            countElement.textContent = `字數：${count}`;
        }

        function clearContent() {
            inputText.value = '';
            outputText.innerHTML = '';
            updateCharCount(inputText, inputCharCount);
            updateCharCount({value: ''}, outputCharCount); // Reset output count
        }

        function copyToClipboard() {
            // 建立 outputText 的一個暫時性複製品來處理文字
            const clone = outputText.cloneNode(true);
            // 在複製品中找出所有被標記為移除的元素
            const removedElements = clone.querySelectorAll('.diff-removed');
            // 將這些元素從複製品中移除
            removedElements.forEach(el => el.remove());
            // 取得清理過後的純文字內容
            const plainText = clone.textContent;

            if (plainText) {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = plainText;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    const originalButtonHTML = copyButton.innerHTML;
                    copyButton.innerHTML = `<span>已複製！</span>`;
                    setTimeout(() => {
                        copyButton.innerHTML = originalButtonHTML;
                    }, 2000);
                } catch (err) {
                    console.error('無法複製文字: ', err);
                }
                document.body.removeChild(tempTextArea);
            }
        }

        async function polishSentence() {
            const originalText = inputText.value.trim();
            if (!originalText) {
                outputText.textContent = '請先輸入您想要潤飾的句子。';
                return;
            }

            // --- Show loading indicator ---
            outputText.innerHTML = '<div class="flex justify-center items-center h-full"><div class="lds-dual-ring"></div></div>';
            polishButton.disabled = true;
            clearButton.disabled = true;
            copyButton.disabled = true;
            polishButton.classList.add('opacity-50', 'cursor-not-allowed');
            clearButton.classList.add('opacity-50', 'cursor-not-allowed');

            const formattingInstruction = " 你的任務是比較原文和優化後的文字，並產生一個能精確顯示差異的 HTML。請嚴格遵循以下規則：1. **未變動的文字**必須保持原樣，不加任何 HTML 標籤。 2. **從原文中刪除的文字**，必須用 `<del>` 標籤包圍。 3. **在新文中增加的文字**，必須用 `<ins>` 標籤包圍。 你的輸出必須是單一的 HTML 字串，不包含任何額外解釋。例如，若原文是「今天天氣很好」，優化後是「今天天氣真好！」，你的輸出就必須是「今天天氣<del>很</del><ins>真</ins>好<ins>！</ins>」。";

            const stylePrompts = {
                general: "你是一位專業的中文寫作專家，請將以下句子潤飾得更通順、精煉，同時完整保留原始語意。",
                professional: "你是一位資深的商業與學術編輯，請將以下文字改寫得非常專業、正式、客觀，適用於報告或論文，同時完整保留原始語意。",
                casual: "你是一位社群文案高手，請將以下句子改寫得更口語化、活潑、有吸引力，適合用在部落格或社群媒體，同時完整保留原始語意。",
                concise: "你是一位精煉的文字編輯，請將以下句子縮短，用最少的字表達核心意思，移除贅字，同時完整保留原始語意。",
                grammar: "你是一位嚴謹的校稿員，請只修正以下句子中的錯別字、標點符號和語法錯誤，不要改變句意或風格。",
                official_document: "你是一位精通政府公文寫作的專家，請將以下文字改寫成符合公文用語規範的正式書面語，確保用詞精確、語氣莊重，同時完整保留原始語意。",
                humorous: "你是一位幽默大師，請將以下句子改寫得輕鬆、有趣、甚至帶點諷刺，但要保留核心意思。",
                poetic: "你是一位詩人，請將以下文字改寫得充滿詩意、意象優美、文字典雅，同時保留原始語意。",
                news: "你是一位資深記者，請將以下文字改寫成客觀、中立、精確的新聞報導風格，同時完整保留原始語意。",
                classical: "你是一位精通古文的學者，請將以下文字改寫成簡潔典雅的文言文風格，同時完整保留原始語意。"
            };

            const selectedStyle = polishStyleSelect.value;
            const systemPrompt = `${stylePrompts[selectedStyle]} ${formattingInstruction} 請直接提供優化後的版本，不需要任何額外解釋。請使用繁體中文回答。`;
            const userQuery = originalText;
            
            // --- API 金鑰和端點 ---
            // !!! 安全警告 !!!
            // 將 API 金鑰直接寫在前端是非常不安全的，任何人都可以看到並盜用。
            // 在正式環境中，您應該透過後端伺-服器來呼叫 API。
            const apiKey = "AIzaSyD1eAmZ-gOlU9VG-06ClJVXg21e4OE17Nc; // <-- 在此處貼上您的 API 金鑰 (僅供測試)
            const modelName = "gemini-1.5-flash-latest";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

            if (!apiKey) {
                outputText.textContent = "錯誤：尚未設定 API 金鑰。請在程式碼中填入您的 Google AI API 金鑰。";
                polishButton.disabled = false;
                clearButton.disabled = false;
                copyButton.disabled = false;
                polishButton.classList.remove('opacity-50', 'cursor-not-allowed');
                clearButton.classList.remove('opacity-50', 'cursor-not-allowed');
                return;
            }

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                safetySettings: [
                    { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                ]
            };

            try {
                let response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`請求失敗，狀態碼：${response.status}. 詳情: ${errorText}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    if (candidate.finishReason === 'SAFETY') {
                        outputText.textContent = '抱歉，您的輸入內容可能違反了使用政策，無法處理。請修改後再試。';
                    } else {
                        const polishedTextWithHtml = candidate.content.parts[0].text;
                        const cleanedHtml = polishedTextWithHtml.replace(/^```html\n?/, '').replace(/```$/, '').trim();
                        const finalHtml = cleanedHtml.replace(/<ins>/g, '<span class="diff-added">')
                                                     .replace(/<\/ins>/g, '</span>')
                                                     .replace(/<del>/g, '<span class="diff-removed">')
                                                     .replace(/<\/del>/g, '</span>');
                        outputText.innerHTML = finalHtml;
                        updateCharCount({value: outputText.textContent}, outputCharCount);
                    }
                } else {
                    outputText.textContent = '抱歉，無法生成結果。請檢查您的輸入或稍後再試。';
                    console.error('Unexpected API response structure:', result);
                }

            } catch (error) {
                console.error('Error:', error);
                outputText.textContent = '發生錯誤，請稍後再試。\n' + error.message;
            } finally {
                polishButton.disabled = false;
                clearButton.disabled = false;
                copyButton.disabled = false;
                polishButton.classList.remove('opacity-50', 'cursor-not-allowed');
                clearButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Initialize char count
        updateCharCount(inputText, inputCharCount);
    </script>
</body>
</html>

