<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>網頁封存工具</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-color: #f5f5f7;
            --text-color: #1d1d1f;
            --text-color-secondary: #6e6e73;
            --window-bg: rgba(252, 252, 252, 0.75); /* 調整透明度與色調 */
            --card-bg: rgba(255, 255, 255, 0.6);   /* 調整透明度 */
            --border-color: rgba(0, 0, 0, 0.1);
        }

        body.dark {
            --bg-color: #1a1a1c;
            --text-color: #f5f5f7;
            --text-color-secondary: #a1a1a6;
            --window-bg: rgba(28, 28, 30, 0.75);   /* 調整透明度與色調 */
            --card-bg: rgba(44, 44, 46, 0.65);     /* 調整透明度與色調 */
            --border-color: rgba(255, 255, 255, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .macos-window {
            background-color: var(--window-bg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transition: background-color 0.3s ease;
        }

        .traffic-dots span {
            display: block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        #theme-toggle .sun, #theme-toggle .moon {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        body.dark #theme-toggle .sun { opacity: 0; transform: rotate(90deg); }
        body:not(.dark) #theme-toggle .moon { opacity: 0; transform: rotate(-90deg); }
        
        .apple-blue { color: #007aff; }
        body.dark .apple-blue { color: #0a84ff; }

        /* --- Animation Styles --- */
        .drag-animation #drag-group { animation: drag-animation-move 4s ease-in-out infinite 0.5s; }
        .drag-animation #cursor { animation: cursor-click-animation 4s ease-in-out infinite 0.5s; transform-origin: 245px 90px; }
        .drag-animation #bookmark-plus { animation: plus-pop-animation 4s ease-in-out infinite 0.5s; transform-origin: center; opacity: 0; }
        .drag-animation.is-dragging #bookmark-bar { animation: bookmark-flash 1.5s ease-in-out infinite; }
        
        .advanced-guide code {
            background-color: rgba(0,0,0,0.05);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
        }
        body.dark .advanced-guide code {
            background-color: rgba(255,255,255,0.1);
        }
        
        .extension-title {
            color: #ef4444; /* red-500 */
        }
        body.dark .extension-title {
            color: #f87171; /* red-400 */
        }
        .animated-icon {
            animation: icon-pulse 2.5s infinite ease-in-out;
        }


        @keyframes drag-animation-move {
            0%, 30%   { transform: translate(0, 0); }
            70%       { transform: translate(0, -53px); }
            80%, 100% { transform: translate(0, -53px); opacity: 1; }
            80.01%, 99.99% { opacity: 0; }
        }
        @keyframes cursor-click-animation {
            0%, 25%     { transform: scale(1); }
            28%         { transform: scale(0.9); }
            32%, 100%   { transform: scale(1); }
        }
        @keyframes plus-pop-animation {
            0%, 70% { opacity: 0; transform: scale(0.5); }
            75%     { opacity: 1; transform: scale(1.2); }
            85%, 100% { opacity: 0; transform: scale(1); }
        }
        @keyframes bookmark-flash {
            0%, 100% { filter: drop-shadow(0 0 1px rgba(0,122,255,0.5)); }
            50% { filter: drop-shadow(0 0 8px rgba(0,122,255,1)); }
        }
        @keyframes icon-pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-6 md:p-8">

    <!-- Theme Toggle -->
    <button id="theme-toggle" class="fixed top-4 right-4 md:top-6 md:right-6 w-10 h-10 flex items-center justify-center rounded-full text-gray-500 hover:bg-gray-500/10 transition-colors z-20">
        <div class="relative w-6 h-6">
             <i data-lucide="sun" class="sun absolute inset-0 text-yellow-500"></i>
             <i data-lucide="moon" class="moon absolute inset-0 text-indigo-400"></i>
        </div>
    </button>

    <div class="w-full max-w-7xl mx-auto">
        <div class="macos-window rounded-xl md:rounded-2xl">
            <!-- Title Bar -->
            <header class="h-14 flex items-center justify-center relative border-b border-[var(--border-color)]">
                <div class="traffic-dots absolute left-4 flex space-x-2">
                    <span style="background-color: #ff5f56;"></span>
                    <span style="background-color: #ffbd2e;"></span>
                    <span style="background-color: #27c93f;"></span>
                </div>
                <div class="text-center">
                    <h1 class="text-2xl sm:text-3xl font-semibold">網頁封存工具</h1>
                </div>
            </header>

            <!-- Content -->
            <main class="p-6 md:p-8">
                <div class="text-center mb-8">
                    <div class="flex justify-center my-4 md:my-6">
                        <svg id="drag-animation-svg" class="drag-animation w-full max-w-xs sm:max-w-sm" viewBox="0 0 280 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="bookmark-bar">
                                <rect x="10" y="2" width="260" height="35" rx="8" fill="currentColor" class="text-gray-200 dark:text-gray-700"/>
                                <text x="140" y="24" text-anchor="middle" font-size="14" fill="currentColor" class="text-gray-500 dark:text-gray-400" font-weight="500">書籤列</text>
                            </g>
                            <path id="bookmark-plus" d="M140 17V23M137 20H143" stroke="#007aff" stroke-width="2.5" stroke-linecap="round"/>
                            <g id="drag-group">
                                <rect x="30" y="55" width="220" height="40" rx="10" fill="#007aff"/>
                                <text x="140" y="81" text-anchor="middle" font-size="16" fill="white" font-weight="600">滑鼠拖曳按鈕到書籤列</text>
                                <g id="cursor"><path d="M0 -22.8L0 0.8L6.8 -3.5L11.7 3.6L16.2 1.9L11.3 -5.2L19.4 -6.9Z" transform="translate(245, 90)" fill="white" stroke="black" stroke-width="1.5" stroke-linejoin="round"/></g>
                            </g>
                        </svg>
                    </div>
                    <h2 class="text-lg sm:text-xl font-bold mb-2">安裝您的存檔工具</h2>
                    <p class="max-w-xl mx-auto" style="color: var(--text-color-secondary);">這是一個<strong class="apple-blue">書籤小工具</strong>。安裝方式很特別：請直接用<strong class="apple-blue">滑鼠按住</strong>下方您偏好的工具按鈕，將它<strong class="apple-blue">拖曳</strong>到您瀏覽器頂端的「<strong class="apple-blue">書籤列</strong>」上<strong class="apple-blue">放開</strong>，即可<strong class="apple-blue">完成安裝</strong>。未来在任何網頁<strong class="apple-blue">點擊這個書籤</strong>，就能立刻<strong class="apple-blue">啟動存檔功能</strong>。</p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 text-left">
                    <!-- Card 1: Save as Image -->
                    <div class="rounded-xl p-5 sm:p-6 flex flex-col" style="background-color: var(--card-bg); border: 1px solid var(--border-color);">
                        <div class="flex items-center mb-3"><i data-lucide="image" class="w-6 h-6 text-purple-400 mr-3"></i><h3 class="font-semibold text-lg sm:text-xl">儲存為圖片</h3></div>
                        <p class="text-base flex-grow mb-4" style="color: var(--text-color-secondary);">將<strong class="apple-blue">整個網頁</strong>擷取為一張<strong class="apple-blue">高解析度 PNG 圖片</strong>，最能確保儲存結果與您看到的<strong class="apple-blue">畫面完全相同</strong>。此功能在處理<strong class="apple-blue">過於複雜</strong>的網頁或遇到<strong class="apple-blue">網站安全限制</strong>時，可能會<strong class="apple-blue">擷取超時或失敗</strong>。</p>
                        <a id="bookmarklet-image" href="#" class="bookmarklet-btn bg-purple-600 hover:bg-purple-700 active:scale-95 transition-transform duration-200 hover:-translate-y-0.5 cursor-grab active:cursor-grabbing mt-auto inline-flex items-center justify-center text-center text-white font-semibold py-2.5 px-4 rounded-lg">
                            <i data-lucide="image" class="w-4 h-4 mr-2"></i><span class="btn-text">網頁儲存為圖片</span>
                        </a>
                    </div>
                    <!-- Card 2: Save as HTML -->
                    <div class="rounded-xl p-5 sm:p-6 flex flex-col" style="background-color: var(--card-bg); border: 1px solid var(--border-color);">
                        <div class="flex items-center mb-3"><i data-lucide="link" class="w-6 h-6 text-teal-400 mr-3"></i><h3 class="font-semibold text-lg sm:text-xl">儲存為HTML</h3></div>
                        <p class="text-base flex-grow mb-4" style="color: var(--text-color-secondary);">僅儲存網頁的 <strong class="apple-blue">HTML 結構</strong>，資源從原始網站載入，<strong class="apple-blue">需要連網</strong>才能完整顯示。檔案<strong class="apple-blue">極小</strong>且<strong class="apple-blue">相容性最高</strong>。</p>
                        <a id="bookmarklet-basic" href="#" class="bookmarklet-btn bg-teal-600 hover:bg-teal-700 active:scale-95 transition-transform duration-200 hover:-translate-y-0.5 cursor-grab active:cursor-grabbing mt-auto inline-flex items-center justify-center text-center text-white font-semibold py-2.5 px-4 rounded-lg">
                            <i data-lucide="link" class="w-4 h-4 mr-2"></i><span class="btn-text">網頁儲存為HTML</span>
                        </a>
                    </div>
                    <!-- Card 3: Save as Markdown -->
                     <div class="rounded-xl p-5 sm:p-6 flex flex-col" style="background-color: var(--card-bg); border: 1px solid var(--border-color);">
                        <div class="flex items-center mb-3"><i data-lucide="clipboard-copy" class="w-6 h-6 text-sky-400 mr-3"></i><h3 class="font-semibold text-lg sm:text-xl">複製為 Markdown</h3></div>
                        <p class="text-base flex-grow mb-4" style="color: var(--text-color-secondary);">擷取頁面<strong class="apple-blue">主要內容</strong>並轉換為 <strong class="apple-blue">Markdown 格式</strong>，再<strong class="apple-blue">自動複製</strong>到剪貼簿。適合快速轉貼文章到<strong class="apple-blue">筆記軟體</strong>或部落格。</p>
                        <a id="bookmarklet-markdown" href="#" class="bookmarklet-btn bg-sky-600 hover:bg-sky-700 active:scale-95 transition-transform duration-200 hover:-translate-y-0.5 cursor-grab active:cursor-grabbing mt-auto inline-flex items-center justify-center text-center text-white font-semibold py-2.5 px-4 rounded-lg">
                           <i data-lucide="clipboard-copy" class="w-4 h-4 mr-2"></i><span class="btn-text">複製為 Markdown</span>
                        </a>
                    </div>
                    <!-- Card 4: Save Offline HTML -->
                    <div class="rounded-xl p-5 sm:p-6 flex flex-col" style="background-color: var(--card-bg); border: 1px solid var(--border-color);">
                        <div class="flex items-center mb-3"><i data-lucide="package-check" class="w-6 h-6 text-orange-400 mr-3"></i><h3 class="font-semibold text-lg sm:text-xl">離線儲存 (HTML)</h3></div>
                        <p class="text-base flex-grow mb-4" style="color: var(--text-color-secondary);">將<strong class="apple-blue">所有圖片與樣式</strong>嵌入檔案中，打包成一個<strong class="apple-blue">單一、可離線瀏覽</strong>的 HTML 檔案。此功能可能因網站<strong class="apple-blue">安全限制 (CSP/CORS)</strong> 而<strong class="apple-blue">不保證成功</strong>，且檔案較大。</p>
                        <a id="bookmarklet-offline" href="#" class="bookmarklet-btn bg-orange-600 hover:bg-orange-700 active:scale-95 transition-transform duration-200 hover:-translate-y-0.5 cursor-grab active:cursor-grabbing mt-auto inline-flex items-center justify-center text-center text-white font-semibold py-2.5 px-4 rounded-lg">
                           <i data-lucide="package-check" class="w-4 h-4 mr-2"></i><span class="btn-text">離線儲存 (HTML)</span>
                        </a>
                    </div>
                </div>

                <!-- How to Use Section -->
                <div class="mt-10 pt-8 border-t border-[var(--border-color)]">
                    <h3 class="text-center text-xl sm:text-2xl font-bold mb-6">如何使用</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                        <div class="flex flex-col items-center">
                            <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center mb-4">
                                <i data-lucide="globe" class="w-8 h-8 text-blue-500"></i>
                            </div>
                            <h4 class="font-semibold mb-1">Step 1: 瀏覽網頁</h4>
                            <p style="color: var(--text-color-secondary);">前往任何您想存檔的網站。</p>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="w-16 h-16 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center mb-4">
                               <i data-lucide="bookmark" class="w-8 h-8 text-green-500"></i>
                            </div>
                            <h4 class="font-semibold mb-1">Step 2: 點擊書籤</h4>
                            <p style="color: var(--text-color-secondary);">點擊您書籤列上的存檔工具。</p>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900/50 rounded-full flex items-center justify-center mb-4">
                               <i data-lucide="download" class="w-8 h-8 text-purple-500"></i>
                            </div>
                            <h4 class="font-semibold mb-1">Step 3: 等待下載</h4>
                            <p style="color: var(--text-color-secondary);">檔案將自動產生並下載。</p>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Guide Section -->
                <div class="advanced-guide mt-10 pt-8 border-t border-[var(--border-color)]">
                    <h3 class="text-center text-xl sm:text-2xl font-bold mb-6">進階說明：繞過網站安全限制 (CSP)</h3>
                    <div class="max-w-4xl mx-auto text-left space-y-6" style="color: var(--text-color-secondary);">
                        <p>您好！當我們的書籤小工具在 Google 新聞等網站失效時，是因為該網站啟用了「內容安全政策 (Content Security Policy, CSP)」。這是一道由網站建立的安全防護，用來阻擋所有未經授權的外部腳本執行，以保護使用者不受惡意攻擊。我們的書籤工具本質上也是一種外部腳本，因此會被阻擋。</p>
                        <p class="font-semibold text-[var(--text-color)]">直接修改書籤工具的程式碼是無法突破 CSP 限制的。</p>
                        <p>不過，我們可以改用其他更高權限的方法來達成存檔目的。以下提供兩種保證成功，但需要手動操作的替代方案：</p>

                        <div class="mt-6 p-6 rounded-xl" style="background-color: var(--card-bg); border: 1px solid var(--border-color);">
                            <h4 class="text-lg sm:text-xl font-bold mb-3 text-[var(--text-color)]">方案一：使用瀏覽器「開發者工具」手動存檔</h4>
                            <p class="mb-4">這個方法是利用瀏覽器內建的強大工具，直接從源頭複製內容或擷取畫面。(過程繁瑣，但 100% 成功)</p>

                            <h5 class="text-md sm:text-lg font-semibold mb-2 mt-4 text-[var(--text-color)]">A. 手動儲存為「離線 HTML」</h5>
                            <ol class="list-decimal list-inside space-y-2">
                                <li>在您想存檔的頁面，按下滑鼠右鍵，選擇「<strong>檢查</strong>」(Inspect)，或是直接按下 <code>F12</code> 鍵來開啟開發者工具。</li>
                                <li>在開發者工具視窗中，切換到「<strong>元素</strong>」(Elements) 頁籤。</li>
                                <li>您會看到整個網頁的 HTML 原始碼。在最頂端找到 <code>&lt;html&gt;</code> 這個標籤。</li>
                                <li>在 <code>&lt;html&gt;</code> 標籤上按下滑鼠右鍵，在選單中依序選擇「<strong>複製</strong>」(Copy) >「<strong>複製 outerHTML</strong>」(Copy outerHTML)。</li>
                                <li>開啟任何純文字編輯器 (例如：記事本、VS Code)，將剛剛複製的內容<strong>貼上</strong>。</li>
                                <li>將這個檔案儲存，檔名自訂，但<strong>副檔名必須是 <code>.html</code></strong> (例如：<code>google_news.html</code>)。</li>
                            </ol>

                            <h5 class="text-md sm:text-lg font-semibold mb-2 mt-6 text-[var(--text-color)]">B. 手動儲存為「高解析度圖片」</h5>
                             <ol class="list-decimal list-inside space-y-2">
                                <li>同樣開啟開發者工具 (<code>F12</code>)。</li>
                                <li>按下組合鍵 <code>Ctrl + Shift + P</code> (Mac 為 <code>Cmd + Shift + P</code>)，開啟指令面板。</li>
                                <li>在指令面板的輸入框中，輸入 <code>screenshot</code>。</li>
                                <li>您會看到幾個選項，請選擇「<strong>擷取完整大小的螢幕截圖</strong>」(Capture full size screenshot)。</li>
                                <li>瀏覽器會自動處理並擷取整個網頁（從頭到尾），然後跳出視窗讓您儲存成 PNG 圖片。</li>
                            </ol>
                        </div>

                        <div class="mt-6 p-6 rounded-xl" style="background-color: var(--card-bg); border: 1px solid var(--border-color);">
                             <h4 class="text-lg sm:text-xl font-bold mb-3 text-[var(--text-color)]">方案二：安裝專門的「瀏覽器擴充功能」 (最推薦)</h4>
                             <p class="mb-4">這是最常見也最方便的解決方案。瀏覽器擴充功能 (Extension) 擁有比書籤小工具高很多的權限，它們可以透過瀏覽器提供的正規 API 來讀取與處理網頁，因此<strong>不會受到 CSP 的限制</strong>。</p>
                             <ul class="space-y-6">
                                <li>
                                    <div class="flex items-start">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animated-icon w-6 h-6 mr-3 flex-shrink-0 mt-1">
                                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="m9 15 2 2 4-4"></path>
                                        </svg>
                                        <div>
                                            <p class="font-semibold text-[var(--text-color)]"><strong class="extension-title">1. SingleFile</strong> (對應我們的「離線儲存」功能)</p>
                                            <p><strong>功能：</strong> 點一下按鈕，就能將整個網頁（包含所有圖片、樣式）打包成<strong>一個</strong>獨立的 HTML 檔案，效果比我們原有的離線儲存功能更強大、成功率更高。</p>
                                            <p><strong>適用瀏覽器：</strong>Chrome, Firefox, Edge</p>
                                        </div>
                                    </div>
                                </li>
                                 <li>
                                     <div class="flex items-start">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animated-icon w-6 h-6 mr-3 flex-shrink-0 mt-1">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path><path d="M15 3h6v6"></path><path d="M9 21H3v-6"></path>
                                        </svg>
                                         <div>
                                            <p class="font-semibold text-[var(--text-color)]"><strong class="extension-title">2. GoFullPage</strong> (對應我們的「儲存為圖片」功能)</p>
                                            <p><strong>功能：</strong> 點一下按鈕，它會自動滾動並完美地擷取整個網頁，存成一張高解析度的圖片或 PDF。</p>
                                            <p><strong>適用瀏覽器：</strong>Chrome, Edge</p>
                                        </div>
                                    </div>
                                </li>
                             </ul>
                        </div>
                        
                        <div class="mt-8 pt-6 border-t border-[var(--border-color)] text-center">
                             <h4 class="text-lg sm:text-xl font-bold mb-3 text-[var(--text-color)]">總結</h4>
                             <ul class="list-none list-inside space-y-2">
                                <li>若您只是<strong>偶爾</strong>需要在有 CSP 限制的網站存檔，學習<strong>方案一</strong>的開發者工具用法即可。</li>
                                <li>若您<strong>經常</strong>有存檔需求，強烈建議您花幾分鐘安裝<strong>方案二</strong>的擴充功能，這將會是您未來最穩定可靠的存檔幫手。</li>
                             </ul>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Logic Scripts (Hidden) -->
    <script id="logic-image" type="text/plain">
(function(){function e(t){let n=document.getElementById("bookmarklet-notifier-style");n&&n.remove();const o=document.createElement("style");o.id="bookmarklet-notifier-style",o.innerHTML=`
    @keyframes progress-ring-anim { to { stroke-dashoffset: 0; } }
    @keyframes notifier-fade-in { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  `,document.head.appendChild(o);let i=!1,s=null,a=null;const d=document.createElement("div");d.style.cssText="position:fixed;top:20px;right:20px;padding:12px;background-color:rgba(0,0,0,.85);color:#fff;z-index:99999999;border-radius:8px;backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.2);font-family:sans-serif;font-size:16px;display:flex;align-items:center;animation:notifier-fade-in 0.3s ease;";const r=document.createElement("span");const c=document.createElement("div");c.style.cssText="width:24px;height:24px;margin-right:10px;position:relative;";const m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width","24"),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.style.transform="rotate(-90deg)";m.innerHTML=`<circle cx="12" cy="12" r="10" fill="transparent" stroke="rgba(255,255,255,0.2)" stroke-width="2.5"></circle><circle cx="12" cy="12" r="10" fill="transparent" stroke="#fff" stroke-width="2.5" stroke-dasharray="62.83" stroke-dashoffset="62.83" class="progress-ring-circle" style="transition: stroke-dashoffset 0.3s linear;"></circle>`;c.appendChild(m);const l=document.createElement("button");function u(){a&&clearTimeout(a),s&&s.remove(),document.body.contains(d)&&document.body.removeChild(d)}return l.textContent="取消",l.style.cssText="margin-left:12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);color:#fff;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:14px;",l.onclick=()=>{i=!0,p("操作已取消。"),setTimeout(u,1500)},d.appendChild(c),d.appendChild(r),d.appendChild(l),{show:function(e,t){if(i)return;document.body.contains(d)||document.body.appendChild(d),r.textContent=e,a&&clearTimeout(a);const n=m.querySelector(".progress-ring-circle");t?(c.style.display="flex",l.style.display="block",n.style.animation=`progress-ring-anim ${t/1e3}s linear forwards`,a=setTimeout(()=>{i=!0,this.error("操作超時！頁面可能過於複雜。")},t)):(c.style.display="none",l.style.display="none")},success:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,p(e),setTimeout(u,2e3)},error:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,p(e),setTimeout(u,4e3)},remove:u,isCancelled:()=>i};function p(e){r.textContent=e,l.style.display="none",a&&clearTimeout(a)}}const t=e();t.show("正在準備擷取畫面...",2e4);function n(o,s){if(t.isCancelled())return;const a=document.createElement("script");a.src=o,a.onload=s,a.onerror=()=>{t.isCancelled()||t.error("錯誤：無法載入資源！")},document.head.appendChild(a)}n("https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js",()=>{if(t.isCancelled())return;t.show("正在擷取畫面...",19e3),html2canvas(document.body,{useCORS:!0,scale:2,windowWidth:document.documentElement.scrollWidth,windowHeight:document.documentElement.scrollHeight,backgroundColor:"#ffffff"}).then(e=>{if(t.isCancelled())return;t.show("正在產生圖片...");const n=document.createElement("a"),o=document.title?document.title.replace(/[^a-z0-9]/gi,"_").toLowerCase():"capture";n.download=`${o}.png`,n.href=e.toDataURL("image/png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),t.success("儲存成功！")}).catch(e=>{t.isCancelled()||(console.error("擷取失敗:",e),t.error("儲存失敗！可能是網站安全限制。"))})})})()
    </script>
    <script id="logic-basic" type="text/plain">
(function(){function e(t){let n=document.getElementById("bookmarklet-notifier-style");n&&n.remove();const o=document.createElement("style");o.id="bookmarklet-notifier-style",o.innerHTML=`
    @keyframes progress-ring-anim { to { stroke-dashoffset: 0; } }
    @keyframes notifier-fade-in { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  `,document.head.appendChild(o);let i=!1,s=null,a=null;const d=document.createElement("div");d.style.cssText="position:fixed;top:20px;right:20px;padding:12px;background-color:rgba(0,0,0,.85);color:#fff;z-index:99999999;border-radius:8px;backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.2);font-family:sans-serif;font-size:16px;display:flex;align-items:center;animation:notifier-fade-in 0.3s ease;";const r=document.createElement("span");const c=document.createElement("div");c.style.cssText="width:24px;height:24px;margin-right:10px;position:relative;";const m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width","24"),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.style.transform="rotate(-90deg)";m.innerHTML=`<circle cx="12" cy="12" r="10" fill="transparent" stroke="rgba(255,255,255,0.2)" stroke-width="2.5"></circle><circle cx="12" cy="12" r="10" fill="transparent" stroke="#fff" stroke-width="2.5" stroke-dasharray="62.83" stroke-dashoffset="62.83" class="progress-ring-circle" style="transition: stroke-dashoffset 0.3s linear;"></circle>`;c.appendChild(m);const l=document.createElement("button");function u(){a&&clearTimeout(a),s&&s.remove(),document.body.contains(d)&&document.body.removeChild(d)}return l.textContent="取消",l.style.cssText="margin-left:12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);color:#fff;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:14px;",l.onclick=()=>{i=!0,p("操作已取消。"),setTimeout(u,1500)},d.appendChild(c),d.appendChild(r),d.appendChild(l),{show:function(e,t){if(i)return;document.body.contains(d)||document.body.appendChild(d),r.textContent=e,a&&clearTimeout(a);const n=m.querySelector(".progress-ring-circle");t?(c.style.display="flex",l.style.display="block",n.style.animation=`progress-ring-anim ${t/1e3}s linear forwards`,a=setTimeout(()=>{i=!0,this.error("操作超時！頁面可能過於複雜。")},t)):(c.style.display="none",l.style.display="none")},success:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,p(e),setTimeout(u,2e3)},error:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,p(e),setTimeout(u,4e3)},remove:u,isCancelled:()=>i};function p(e){r.textContent=e,l.style.display="none",a&&clearTimeout(a)}}const t=e();t.show("正在準備連結儲存...",3e3);try{t.show("正在產生檔案...");let e=document.documentElement.cloneNode(!0),n=e.querySelector("head"),o=n.querySelector("base");o||(o=document.createElement("base"),o.href=window.location.href,n.prepend(o)),e.querySelectorAll("script, noscript").forEach(e=>e.remove());let i=document.title?document.title.replace(/[^a-z0-9]/gi,"_").toLowerCase():"saved_page",s=new Blob([`<!DOCTYPE html>\n${e.outerHTML}`],{type:"text/html"}),a=URL.createObjectURL(s),d=document.createElement("a");d.href=a,d.download=`${i}_linked.html`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(a),t.success("連結儲存成功！")}catch(n){console.error("連結儲存時發生錯誤:",n),t.error("儲存失敗！請查看控制台。")}})()
    </script>
    <script id="logic-markdown" type="text/plain">
(function(){function e(t){let n=document.getElementById("bookmarklet-notifier-style");n&&n.remove();const o=document.createElement("style");o.id="bookmarklet-notifier-style",o.innerHTML=`
    @keyframes progress-ring-anim { to { stroke-dashoffset: 0; } }
    @keyframes notifier-fade-in { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  `,document.head.appendChild(o);let i=!1,s=null,a=null;const d=document.createElement("div");d.style.cssText="position:fixed;top:20px;right:20px;padding:12px;background-color:rgba(0,0,0,.85);color:#fff;z-index:99999999;border-radius:8px;backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.2);font-family:sans-serif;font-size:16px;display:flex;align-items:center;animation:notifier-fade-in 0.3s ease;";const r=document.createElement("span");const c=document.createElement("div");c.style.cssText="width:24px;height:24px;margin-right:10px;position:relative;";const m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width","24"),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.style.transform="rotate(-90deg)";m.innerHTML=`<circle cx="12" cy="12" r="10" fill="transparent" stroke="rgba(255,255,255,0.2)" stroke-width="2.5"></circle><circle cx="12" cy="12" r="10" fill="transparent" stroke="#fff" stroke-width="2.5" stroke-dasharray="62.83" stroke-dashoffset="62.83" class="progress-ring-circle" style="transition: stroke-dashoffset 0.3s linear;"></circle>`;c.appendChild(m);const l=document.createElement("button");function u(){a&&clearTimeout(a),s&&s.remove(),document.body.contains(d)&&document.body.removeChild(d)}return l.textContent="取消",l.style.cssText="margin-left:12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);color:#fff;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:14px;",l.onclick=()=>{i=!0,p("操作已取消。"),setTimeout(u,1500)},d.appendChild(c),d.appendChild(r),d.appendChild(l),{show:function(e,t){if(i)return;document.body.contains(d)||document.body.appendChild(d),r.textContent=e,a&&clearTimeout(a);const n=m.querySelector(".progress-ring-circle");t?(c.style.display="flex",l.style.display="block",n.style.animation=`progress-ring-anim ${t/1e3}s linear forwards`,a=setTimeout(()=>{i=!0,this.error("操作超時！頁面可能過於複雜。")},t)):(c.style.display="none",l.style.display="none")},success:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,p(e),setTimeout(u,2e3)},error:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,p(e),setTimeout(u,4e3)},remove:u,isCancelled:()=>i};function p(e){r.textContent=e,l.style.display="none",a&&clearTimeout(a)}}const t=e();function n(o,i){if(t.isCancelled())return;const s=document.createElement("script");s.src=o,s.onload=i,s.onerror=()=>{t.isCancelled()||t.error("錯誤：無法載入資源！")},document.head.appendChild(s)}t.show("正在載入轉換工具...",5e3),n("https://unpkg.com/turndown/dist/turndown.js",()=>{if(t.isCancelled())return;try{t.show("正在轉換內容...",4e3);const e=new TurndownService({headingStyle:"atx",hr:"---",bulletListMarker:"-",codeBlockStyle:"fenced"}),n=e.turndown(document.body);navigator.clipboard.writeText(n).then(()=>{t.success("成功複製到剪貼簿！")}).catch(e=>{console.error("複製失敗:",e),t.error("複製失敗！請查看控制台。")})}catch(o){console.error("轉換失敗:",o),t.error("轉換失敗！請查看控制台。")}})})()
    </script>
    <script id="logic-offline" type="text/plain">
(async function(){function e(t){let n=document.getElementById("bookmarklet-notifier-style");n&&n.remove();const o=document.createElement("style");o.id="bookmarklet-notifier-style",o.innerHTML=`
    @keyframes progress-ring-anim { to { stroke-dashoffset: 0; } }
    @keyframes notifier-fade-in { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  `,document.head.appendChild(o);let i=!1,s=null,a=null;const d=document.createElement("div");d.style.cssText="position:fixed;top:20px;right:20px;padding:12px;background-color:rgba(0,0,0,.85);color:#fff;z-index:99999999;border-radius:8px;backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.2);font-family:sans-serif;font-size:16px;display:flex;align-items:center;animation:notifier-fade-in 0.3s ease;";const r=document.createElement("span");const c=document.createElement("div");c.style.cssText="width:24px;height:24px;margin-right:10px;position:relative;";const m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width","24"),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.style.transform="rotate(-90deg)";m.innerHTML=`<circle cx="12" cy="12" r="10" fill="transparent" stroke="rgba(255,255,255,0.2)" stroke-width="2.5"></circle><circle cx="12" cy="12" r="10" fill="transparent" stroke="#fff" stroke-width="2.5" stroke-dasharray="62.83" stroke-dashoffset="62.83" class="progress-ring-circle" style="transition: stroke-dashoffset 0.3s linear;"></circle>`;c.appendChild(m);const l=document.createElement("button");function u(){a&&clearTimeout(a),s&&s.remove(),document.body.contains(d)&&document.body.removeChild(d)}return l.textContent="取消",l.style.cssText="margin-left:12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);color:#fff;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:14px;",l.onclick=()=>{i=!0,p("操作已取消。"),setTimeout(u,1500)},d.appendChild(c),d.appendChild(r),d.appendChild(l),{show:function(e,t){if(i)return;document.body.contains(d)||document.body.appendChild(d),r.textContent=e,a&&clearTimeout(a);const n=m.querySelector(".progress-ring-circle");t?(c.style.display="flex",l.style.display="block",n.style.animation=`progress-ring-anim ${t/1e3}s linear forwards`,a=setTimeout(()=>{i=!0,this.error("操作超時！頁面可能過於複雜。")},t)):(c.style.display="none",l.style.display="none")},success:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,p(e),setTimeout(u,2e3)},error:function(e){if(i)return;c.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,p(e),setTimeout(u,4e3)},remove:u,isCancelled:()=>i};function p(e){r.textContent=e,l.style.display="none",a&&clearTimeout(a)}}const t=e();try{const e=document.documentElement.cloneNode(!0);t.show("準備離線儲存...",3e4);async function n(e){try{let t=await fetch(e,{cache:"force-cache",mode:"cors"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let n=await t.blob();return await new Promise((e,t)=>{let o=new FileReader;o.onloadend=()=>e(o.result),o.onerror=t,o.readAsDataURL(n)})}catch(o){return console.warn(`無法載入資源: ${e}`),Promise.resolve(e)}}t.show("正在內嵌樣式表...",25e3);const o=Array.from(e.querySelectorAll('link[rel="stylesheet"]')).map(async t=>{if(t.isCancelled())return;try{const e=await fetch(t.href),n=await e.text(),o=document.createElement("style");o.textContent=n,t.parentNode.replaceChild(o,t)}catch(i){console.warn("無法內嵌樣式表:",t.href)}});await Promise.all(o),t.show("正在內嵌圖片...",15e3);const i=Array.from(e.querySelectorAll("img")).map(async e=>{if(t.isCancelled())return;if(e.src&&!e.src.startsWith("data:")){const t=await n(e.src);e.src=t}});await Promise.all(i),t.show("正在產生檔案...",5e3),e.querySelectorAll("script, noscript").forEach(e=>e.remove());const s=document.title?document.title.replace(/[^a-z0-9]/gi,"_").toLowerCase():"saved_page_offline",a=new Blob([`<!DOCTYPE html>\n${e.outerHTML}`],{type:"text/html"}),d=URL.createObjectURL(a),r=document.createElement("a");r.href=d,r.download=`${s}.html`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(d),t.success("離線儲存成功！")}catch(c){console.error("離線儲存時發生錯誤:",c),t.isCancelled()||(c instanceof TypeError?t.error("儲存失敗！目標網站可能存在安全限制。"):t.error("儲存失敗！請查看控制台。"))}})()
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // --- Theme Toggle Logic ---
            const themeToggle = document.getElementById('theme-toggle');
            if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark');
                localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
            });

            // --- Bookmarklet Setup Logic ---
            function setupBookmarklet(buttonId, logicId) {
                const link = document.getElementById(buttonId);
                if (!link) return;
                const logic = document.getElementById(logicId).textContent.trim();
                link.href = 'javascript:' + encodeURIComponent(logic);
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    alert('安裝方式：請用滑鼠將此按鈕「拖曳」到您的書籤列上。');
                });
            }

            ['image', 'basic', 'markdown', 'offline'].forEach(type => {
                setupBookmarklet(`bookmarklet-${type}`, `logic-${type}`);
            });

            // --- Drag Feedback Logic ---
            const svg = document.getElementById('drag-animation-svg');
            document.querySelectorAll('.bookmarklet-btn').forEach(btn => {
                const originalText = btn.querySelector('.btn-text').textContent;
                btn.addEventListener('dragstart', () => svg.classList.add('is-dragging'));
                btn.addEventListener('dragend', () => {
                    svg.classList.remove('is-dragging');
                    const textSpan = btn.querySelector('.btn-text');
                    textSpan.textContent = '安裝成功！';
                    setTimeout(() => { textSpan.textContent = originalText; }, 2000);
                });
            });
        });
    </script>

</body>
</html>
